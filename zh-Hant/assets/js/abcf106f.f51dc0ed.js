"use strict";(self.webpackChunk_lexical_website=self.webpackChunk_lexical_website||[]).push([[7318],{83308:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>c,contentTitle:()=>o,default:()=>x,frontMatter:()=>i,metadata:()=>d,toc:()=>l});var t=n(31085),s=n(71184);const i={},o="\u76e3\u807d\u5668 (Listeners)",d={id:"concepts/listeners",title:"\u76e3\u807d\u5668 (Listeners)",description:"\u76e3\u807d\u5668\u662f\u4e00\u7a2e\u6a5f\u5236\uff0c\u4f7f\u7de8\u8f2f\u5668\u5be6\u4f8b\u80fd\u5920\u5728\u67d0\u4e9b\u64cd\u4f5c\u767c\u751f\u6642\u901a\u77e5\u4f7f\u7528\u8005\u3002\u6240\u6709\u76e3\u807d\u5668\u90fd\u9075\u5faa\u4e00\u7a2e\u53cd\u61c9\u5f0f\u6a21\u5f0f\uff0c\u60a8\u53ef\u4ee5\u5728\u672a\u4f86\u67d0\u4e9b\u4e8b\u4ef6\u767c\u751f\u6642\u9032\u884c\u64cd\u4f5c\u3002\u6240\u6709\u76e3\u807d\u5668\u9084\u6703\u8fd4\u56de\u4e00\u500b\u51fd\u5f0f\uff0c\u4f7f\u60a8\u53ef\u4ee5\u8f15\u9b06\u5730\u53d6\u6d88\u8a3b\u518a\u76e3\u807d\u5668\u3002\u4ee5\u4e0b\u662f Lexical \u76ee\u524d\u652f\u63f4\u7684\u4e0d\u540c\u76e3\u807d\u5668\uff1a",source:"@site/i18n/zh-Hant/docusaurus-plugin-content-docs/current/concepts/listeners.md",sourceDirName:"concepts",slug:"/concepts/listeners",permalink:"/zh-Hant/docs/concepts/listeners",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/lexical/tree/main/packages/lexical-website/docs/concepts/listeners.md",tags:[],version:"current",frontMatter:{},sidebar:"docs",previous:{title:"\u7bc0\u9ede\u8986\u5beb (Node Overrides)",permalink:"/zh-Hant/docs/concepts/node-replacement"},next:{title:"\u7bc0\u9ede\u8f49\u63db",permalink:"/zh-Hant/docs/concepts/transforms"}},c={},l=[{value:"<code>registerUpdateListener</code>",id:"registerupdatelistener",level:2},{value:"<code>registerTextContentListener</code>",id:"registertextcontentlistener",level:2},{value:"<code>registerMutationListener</code>",id:"registermutationlistener",level:2},{value:"<code>registerEditableListener</code>",id:"registereditablelistener",level:2},{value:"<code>registerDecoratorListener</code>",id:"registerdecoratorlistener",level:2},{value:"<code>registerRootListener</code>",id:"registerrootlistener",level:2}];function a(e){const r={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(r.header,{children:(0,t.jsx)(r.h1,{id:"\u76e3\u807d\u5668-listeners",children:"\u76e3\u807d\u5668 (Listeners)"})}),"\n",(0,t.jsx)(r.p,{children:"\u76e3\u807d\u5668\u662f\u4e00\u7a2e\u6a5f\u5236\uff0c\u4f7f\u7de8\u8f2f\u5668\u5be6\u4f8b\u80fd\u5920\u5728\u67d0\u4e9b\u64cd\u4f5c\u767c\u751f\u6642\u901a\u77e5\u4f7f\u7528\u8005\u3002\u6240\u6709\u76e3\u807d\u5668\u90fd\u9075\u5faa\u4e00\u7a2e\u53cd\u61c9\u5f0f\u6a21\u5f0f\uff0c\u60a8\u53ef\u4ee5\u5728\u672a\u4f86\u67d0\u4e9b\u4e8b\u4ef6\u767c\u751f\u6642\u9032\u884c\u64cd\u4f5c\u3002\u6240\u6709\u76e3\u807d\u5668\u9084\u6703\u8fd4\u56de\u4e00\u500b\u51fd\u5f0f\uff0c\u4f7f\u60a8\u53ef\u4ee5\u8f15\u9b06\u5730\u53d6\u6d88\u8a3b\u518a\u76e3\u807d\u5668\u3002\u4ee5\u4e0b\u662f Lexical \u76ee\u524d\u652f\u63f4\u7684\u4e0d\u540c\u76e3\u807d\u5668\uff1a"}),"\n",(0,t.jsx)(r.h2,{id:"registerupdatelistener",children:(0,t.jsx)(r.code,{children:"registerUpdateListener"})}),"\n",(0,t.jsx)(r.p,{children:"\u7576 Lexical \u5c07\u66f4\u65b0\u63d0\u4ea4\u5230 DOM \u6642\u6536\u5230\u901a\u77e5\u3002"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-js",children:"const removeUpdateListener = editor.registerUpdateListener(({editorState}) => {\r\n  // \u6700\u65b0\u7684 EditorState \u53ef\u4ee5\u4f5c\u70ba `editorState` \u627e\u5230\u3002\r\n  // \u8981\u8b80\u53d6 EditorState \u7684\u5167\u5bb9\uff0c\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b API\uff1a\r\n\r\n  editorState.read(() => {\r\n    // \u5c31\u50cf editor.update() \u4e00\u6a23\uff0c.read() \u9700\u8981\u4e00\u500b\u9589\u5305\uff0c\u5728\u5176\u4e2d\u53ef\u4ee5\u4f7f\u7528\r\n    // \u4ee5 $ \u70ba\u524d\u7db4\u7684\u8f14\u52a9\u51fd\u5f0f\u3002\r\n  });\r\n});\r\n\r\n// \u7576\u4e0d\u518d\u9700\u8981\u6642\uff0c\u8acb\u4e0d\u8981\u5fd8\u8a18\u53d6\u6d88\u8a3b\u518a\u76e3\u807d\u5668\uff01\r\nremoveUpdateListener();\n"})}),"\n",(0,t.jsx)(r.p,{children:"\u66f4\u65b0\u76e3\u807d\u5668\u7684\u56de\u547c\u51fd\u5f0f\u6703\u63a5\u6536\u4e00\u500b\u5305\u542b\u4ee5\u4e0b\u5c6c\u6027\u7684\u53c3\u6578\uff1a"}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.code,{children:"editorState"}),"\uff1a\u6700\u65b0\u66f4\u65b0\u7684\u7de8\u8f2f\u5668\u72c0\u614b"]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.code,{children:"prevEditorState"}),"\uff1a\u5148\u524d\u7684\u7de8\u8f2f\u5668\u72c0\u614b"]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.code,{children:"tags"}),"\uff1a\u4e00\u500b\u5305\u542b\u6240\u6709\u50b3\u905e\u5230\u66f4\u65b0\u4e2d\u7684\u6a19\u7c64\u7684\u96c6\u5408"]}),"\n"]}),"\n",(0,t.jsx)(r.p,{children:"\u9700\u8981\u6ce8\u610f\u7684\u4e00\u4ef6\u4e8b\u662f\u300c\u7011\u5e03\u300d\u66f4\u65b0\u3002\u9019\u6307\u7684\u662f\u5728\u66f4\u65b0\u76e3\u807d\u5668\u5167\u5b89\u6392\u53e6\u4e00\u500b\u66f4\u65b0\uff0c\u5982\u4e0b\u6240\u793a\uff1a"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-js",children:"editor.registerUpdateListener(({editorState}) => {\r\n  // \u8b80\u53d6 editorState \u4e26\u53ef\u80fd\u7372\u53d6\u67d0\u4e9b\u503c\u3002\r\n  editorState.read(() => {\r\n    // ...\r\n  });\r\n\r\n  // \u7136\u5f8c\u5b89\u6392\u53e6\u4e00\u500b\u66f4\u65b0\u3002\r\n  editor.update(() => {\r\n    // ...\r\n  });\r\n});\n"})}),"\n",(0,t.jsxs)(r.p,{children:["\u9019\u7a2e\u6a21\u5f0f\u7684\u554f\u984c\u5728\u65bc\uff0c\u6211\u5011\u6700\u7d42\u6703\u9032\u884c\u5169\u6b21 DOM \u66f4\u65b0\uff0c\u800c\u6211\u5011\u672c\u53ef\u4ee5\u5728\u4e00\u6b21 DOM \u66f4\u65b0\u4e2d\u5b8c\u6210\u3002\u9019\u53ef\u80fd\u6703\u5f71\u97ff\u6027\u80fd\uff0c\u9019\u5c0d\u6587\u5b57\u7de8\u8f2f\u5668\u975e\u5e38\u91cd\u8981\u3002\u70ba\u4e86\u907f\u514d\u9019\u7a2e\u60c5\u6cc1\uff0c\u6211\u5011\u5efa\u8b70\u77ad\u89e3 ",(0,t.jsx)(r.a,{href:"https://lexical.dev/docs/concepts/transforms",children:"Node Transforms"}),"\uff0c\u9019\u53ef\u4ee5\u8b93\u60a8\u76e3\u807d\u7bc0\u9ede\u8b8a\u66f4\u4e26\u5728\u540c\u4e00\u6b21\u66f4\u65b0\u4e2d\u9032\u884c\u8f49\u63db\uff0c\u5f9e\u800c\u907f\u514d\u7011\u5e03\u6548\u61c9\uff01"]}),"\n",(0,t.jsx)(r.h2,{id:"registertextcontentlistener",children:(0,t.jsx)(r.code,{children:"registerTextContentListener"})}),"\n",(0,t.jsx)(r.p,{children:"\u7576 Lexical \u5c07\u66f4\u65b0\u63d0\u4ea4\u5230 DOM \u4e26\u4e14\u7de8\u8f2f\u5668\u7684\u6587\u5b57\u5167\u5bb9\u8207\u4e4b\u524d\u7684\u72c0\u614b\u767c\u751f\u8b8a\u5316\u6642\u6536\u5230\u901a\u77e5\u3002\u5982\u679c\u6587\u5b57\u5167\u5bb9\u5728\u66f4\u65b0\u4e4b\u9593\u6c92\u6709\u8b8a\u5316\uff0c\u5247\u4e0d\u6703\u901a\u77e5\u76e3\u807d\u5668\u3002"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-js",children:"const removeTextContentListener = editor.registerTextContentListener(\r\n  (textContent) => {\r\n    // \u7de8\u8f2f\u5668\u7684\u6700\u65b0\u6587\u5b57\u5167\u5bb9\uff01\r\n    console.log(textContent);\r\n  },\r\n);\r\n\r\n// \u7576\u4e0d\u518d\u9700\u8981\u6642\uff0c\u8acb\u4e0d\u8981\u5fd8\u8a18\u53d6\u6d88\u8a3b\u518a\u76e3\u807d\u5668\uff01\r\nremoveTextContentListener();\n"})}),"\n",(0,t.jsx)(r.h2,{id:"registermutationlistener",children:(0,t.jsx)(r.code,{children:"registerMutationListener"})}),"\n",(0,t.jsx)(r.p,{children:"\u7576\u7279\u5b9a\u985e\u578b\u7684 Lexical \u7bc0\u9ede\u767c\u751f\u8b8a\u7570\u6642\u6536\u5230\u901a\u77e5\u3002\u8b8a\u7570\u6709\u4e09\u7a2e\u72c0\u614b\uff1a"}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.code,{children:"created"}),"\uff08\u5df2\u5275\u5efa\uff09"]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.code,{children:"destroyed"}),"\uff08\u5df2\u92b7\u6bc0\uff09"]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.code,{children:"updated"}),"\uff08\u5df2\u66f4\u65b0\uff09"]}),"\n"]}),"\n",(0,t.jsx)(r.p,{children:"\u8b8a\u7570\u76e3\u807d\u5668\u975e\u5e38\u9069\u5408\u8ffd\u8e64\u7279\u5b9a\u985e\u578b\u7bc0\u9ede\u7684\u751f\u547d\u5468\u671f\u3002\u5b83\u5011\u53ef\u7528\u65bc\u8655\u7406\u8207\u7279\u5b9a\u985e\u578b\u7bc0\u9ede\u76f8\u95dc\u7684\u5916\u90e8 UI \u72c0\u614b\u548c UI \u529f\u80fd\u3002"}),"\n",(0,t.jsx)(r.p,{children:"\u5982\u679c DOM \u4e2d\u5df2\u6709\u7bc0\u9ede\uff0c\u4e14 skipInitialization \u672a\u8a2d\u70ba true\uff0c\u5247\u76e3\u807d\u5668\u5c07\u7acb\u5373\u88ab\u8abf\u7528\uff0c\u4e26\u4e14\u6240\u6709\u7bc0\u9ede\u7684 NodeMutation \u72c0\u614b\u5747\u70ba\u300ccreated\u300d\u3002\u9019\u53ef\u4ee5\u901a\u904e skipInitialization \u9078\u9805\u4f86\u63a7\u5236\uff08\u9ed8\u8a8d\u70ba true\uff0c\u4ee5\u8207 0.17.x \u5411\u5f8c\u76f8\u5bb9\uff0c\u4f46\u5728 0.18.0 \u4e2d\u5c07\u66f4\u6539\u70ba false\uff09\u3002"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-js",children:"const removeMutationListener = editor.registerMutationListener(\r\n  MyCustomNode,\r\n  (mutatedNodes, {updateTags, dirtyLeaves, prevEditorState}) => {\r\n    // mutatedNodes \u662f\u4e00\u500b Map\uff0c\u5176\u4e2d\u6bcf\u500b\u9375\u662f NodeKey\uff0c\u503c\u662f\u8b8a\u7570\u7684\u72c0\u614b\u3002\r\n    for (let [nodeKey, mutation] of mutatedNodes) {\r\n      console.log(nodeKey, mutation);\r\n    }\r\n  },\r\n  {skipInitialization: false},\r\n);\r\n\r\n// \u7576\u4e0d\u518d\u9700\u8981\u6642\uff0c\u8acb\u4e0d\u8981\u5fd8\u8a18\u53d6\u6d88\u8a3b\u518a\u76e3\u807d\u5668\uff01\r\nremoveMutationListener();\n"})}),"\n",(0,t.jsx)(r.h2,{id:"registereditablelistener",children:(0,t.jsx)(r.code,{children:"registerEditableListener"})}),"\n",(0,t.jsxs)(r.p,{children:["\u7576\u7de8\u8f2f\u5668\u7684\u6a21\u5f0f\u767c\u751f\u8b8a\u5316\u6642\u6536\u5230\u901a\u77e5\u3002\u7de8\u8f2f\u5668\u7684\u6a21\u5f0f\u53ef\u4ee5\u901a\u904e ",(0,t.jsx)(r.code,{children:"editor.setEditable(boolean)"})," \u4f86\u66f4\u6539\u3002"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-js",children:"const removeEditableListener = editor.registerEditableListener((editable) => {\r\n  // \u7de8\u8f2f\u5668\u7684\u6a21\u5f0f\u6703\u50b3\u905e\u9032\u4f86\uff01\r\n  console.log(editable);\r\n});\r\n\r\n// \u7576\u4e0d\u518d\u9700\u8981\u6642\uff0c\u8acb\u4e0d\u8981\u5fd8\u8a18\u53d6\u6d88\u8a3b\u518a\u76e3\u807d\u5668\uff01\r\nremoveEditableListener();\n"})}),"\n",(0,t.jsx)(r.h2,{id:"registerdecoratorlistener",children:(0,t.jsx)(r.code,{children:"registerDecoratorListener"})}),"\n",(0,t.jsxs)(r.p,{children:["\u7576\u7de8\u8f2f\u5668\u7684\u88dd\u98fe\u7269\u4ef6\u8b8a\u5316\u6642\u6536\u5230\u901a\u77e5\u3002\u88dd\u98fe\u7269\u4ef6\u5305\u542b\u6240\u6709 ",(0,t.jsx)(r.code,{children:"DecoratorNode"})," \u9375\u53ca\u5176\u88dd\u98fe\u503c\u3002\u9019\u4e3b\u8981\u7528\u65bc\u5916\u90e8 UI \u6846\u67b6\u3002"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-js",children:"const removeDecoratorListener = editor.registerDecoratorListener(\r\n  (decorators) => {\r\n    // \u7de8\u8f2f\u5668\u7684\u88dd\u98fe\u7269\u4ef6\u6703\u50b3\u905e\u9032\u4f86\uff01\r\n    console.log(decorators);\r\n  },\r\n);\r\n\r\n// \u7576\u4e0d\u518d\u9700\u8981\u6642\uff0c\u8acb\u4e0d\u8981\u5fd8\u8a18\u53d6\u6d88\u8a3b\u518a\u76e3\u807d\u5668\uff01\r\nremoveDecoratorListener();\n"})}),"\n",(0,t.jsx)(r.h2,{id:"registerrootlistener",children:(0,t.jsx)(r.code,{children:"registerRootListener"})}),"\n",(0,t.jsxs)(r.p,{children:["\u7576\u7de8\u8f2f\u5668\u7684\u6839 DOM \u5143\u7d20\uff08Lexical \u9644\u52a0\u5230\u7684\u53ef\u7de8\u8f2f\u5167\u5bb9\uff09\u767c\u751f\u8b8a\u5316\u6642\u6536\u5230\u901a\u77e5\u3002\u9019\u4e3b\u8981\u7528\u65bc\u5c07\u4e8b\u4ef6\u76e3\u807d\u5668\u9644\u52a0\u5230\u6839\u5143\u7d20\u3002",(0,t.jsx)(r.em,{children:"\u6839\u76e3\u807d\u5668\u51fd\u5f0f\u5728\u8a3b\u518a\u6642\u7acb\u5373\u57f7\u884c\uff0c\u4e26\u5728\u4efb\u4f55\u5f8c\u7e8c\u66f4\u65b0\u6642\u57f7\u884c\u3002"})]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-js",children:"const removeRootListener = editor.registerRootListener(\r\n  (rootElement, prevRootElement) => {\r\n    // \u70ba\u65b0\u6839\u5143\u7d20\u6dfb\u52a0\u76e3\u807d\u5668\r\n    // \u5f9e\u820a\u6839\u5143\u7d20\u79fb\u9664\u76e3\u807d\u5668\r\n  },\r\n);\r\n\r\n// \u7576\u4e0d\u518d\u9700\u8981\u6642\uff0c\u8acb\u4e0d\u8981\u5fd8\u8a18\u53d6\u6d88\u8a3b\u518a\u76e3\u807d\u5668\uff01\r\nremoveRootListener();\n"})})]})}function x(e={}){const{wrapper:r}={...(0,s.R)(),...e.components};return r?(0,t.jsx)(r,{...e,children:(0,t.jsx)(a,{...e})}):a(e)}},71184:(e,r,n)=>{n.d(r,{R:()=>o,x:()=>d});var t=n(14041);const s={},i=t.createContext(s);function o(e){const r=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function d(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),t.createElement(i.Provider,{value:r},e.children)}}}]);